<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rqti">
<title>Working with API OPAL from rqti • rqti</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with API OPAL from rqti">
<meta property="og:description" content="rqti">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rqti</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Create Rmd exercises</h6>
    <a class="dropdown-item" href="../articles/singlechoice.html">Single Choice Exercises</a>
    <a class="dropdown-item" href="../articles/multiplechoice.html">Multiple Choice Exercises</a>
    <a class="dropdown-item" href="../articles/gap.html">Gap Exercises</a>
    <a class="dropdown-item" href="../articles/dropdown.html">Dropdown Exercises</a>
    <a class="dropdown-item" href="../articles/essay.html">Essay Exercises</a>
    <a class="dropdown-item" href="../articles/order.html">Order Exercises</a>
    <a class="dropdown-item" href="../articles/directedpairs.html">Directed Pairs Exercises</a>
    <a class="dropdown-item" href="../articles/table.html">Table Exercises</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Create sections and tests</h6>
    <a class="dropdown-item" href="../articles/section.html">Sections and Tests</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>API</h6>
    <a class="dropdown-item" href="../articles/api_opal.html">Working with API OPAL from rqti</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>S4 rqti classes</h6>
    <a class="dropdown-item" href="../articles/qti_oop_model.html">QTI OOP Model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/shevandrin/rqti/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Working with API OPAL from rqti</h1>
            
            <h4 data-toc-skip class="date">2024-02-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/shevandrin/rqti/blob/HEAD/vignettes/api_opal.Rmd" class="external-link"><code>vignettes/api_opal.Rmd</code></a></small>
      <div class="d-none name"><code>api_opal.Rmd</code></div>
    </div>

    
    
<hr>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>rqti</code> package facilitates seamless content uploads to
the OPAL learning management system through its <code>upload2opal</code>
function, leveraging the OPAL API.</p>
<ol style="list-style-type: decimal">
<li><p><strong>Upload from a Zip Archive:</strong> If you possess a
pre-existing zip archive containing a QTI-compliant test, it can be
effortlessly uploaded to OPAL.</p></li>
<li><p><strong>Upload from an Rmd File:</strong> For Rmd exercise files,
the <code>upload2opal</code> function wraps them into a zip archive
before initiating the upload process to OPAL.</p></li>
<li><p><strong>Upload from an XML File:</strong> Should you have a
QTI-compliant exercise file in XML format, the <code>upload2opal</code>
function wraps it into a zip archive prior to uploading it to
OPAL.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>To leverage the functionality of the OPAL API, it is essential for
OPAL users to possess the requisite permissions. Access to the system
necessitates logging in with a username and password. Please note that
utilizing the API through Shibboleth authorization is not supported.</p>
<p>If you currently lack a password-based login, kindly submit a request
for one through your IT department. For users affiliated with <strong>TU
Chemnitz</strong>, you can expedite this process by sending an email to
<a href="mailto:e-learning@tu-chemnitz.de" class="email">e-learning@tu-chemnitz.de</a>. In your email, explicitly
state your need for a password-based login to facilitate API usage, and
include your username for reference.</p>
<p>To store the username and password, <code>rqti</code> uses the
keyring system credential storage. The first time authentication is
attempted, it asks for a username and a password and saves them in a key
with service name “qtiopal”. Once the key is created, it is
automatically used in further sessions. It is not recommended to create
additional keys so that the workflow runs smoothly.</p>
<p>Some universities only allow to use the OPAL API in the network of
the university. Before calling <code><a href="../reference/upload2opal.html">upload2opal()</a></code> set up a VPN
client accordingly. For TU Chemnitz <a href="https://www.tu-chemnitz.de/urz/network/access/vpn.html" class="external-link">see the
instructions here</a></p>
</div>
<div class="section level2">
<h2 id="uploading-testexercise-to-opal">Uploading test/exercise to OPAL<a class="anchor" aria-label="anchor" href="#uploading-testexercise-to-opal"></a>
</h2>
<p>You can either set the <code>knit: rqti::render_opal</code> parameter
in the yaml-section of your Rmd file or just call
<code><a href="../reference/upload2opal.html">upload2opal()</a></code> with the file as the first parameter:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file</span> <span class="op">&lt;-</span> <span class="st">"my_zip_file.zip"</span> <span class="co"># or "exercise.Rmd" or "exercise.xml"</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/upload2opal.html">upload2opal</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span></code></pre></div>
<p>If this is successful you can expect the following outcomes:</p>
<ol style="list-style-type: decimal">
<li><p>A web browser will open automatically, displaying the OPAL page
with your uploaded test or exercise.</p></li>
<li><p>In your R console, you will receive a status code 200. This
status code indicates that the request to upload the content to OPAL was
successful.</p></li>
<li><p>The result variable will contain a list with the following
data:</p></li>
</ol>
<ul>
<li>$key: An identifier for this resource on OPAL, which you can use for
reference.</li>
<li>$display_name: The title of the resource as it appears in the
browser on OPAL.</li>
<li>$url: A permanent link to access this resource on OPAL.</li>
</ul>
<p><code><a href="../reference/upload2opal.html">upload2opal()</a></code> always checks the uniqueness of the
<code>display_name</code> in your personal repository of resources on
OPAL. If a resource with the same name is found, <code>rqti</code> will
overwrite it by default. This is useful for incrementally improving and
previewing/testing the exercise. It avoids cluttering your OPAL repo
with dozens of versions of the same exercise. If there are several
resources with the same name, <code>upload2opal</code> will ask you what
to do.</p>
<p>By default <code><a href="../reference/upload2opal.html">upload2opal()</a></code> uses the file name as the
<code>display_name</code>. But you can define your own as the second
parameter:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/upload2opal.html">upload2opal</a></span><span class="op">(</span><span class="va">file</span>, display_name <span class="op">=</span> <span class="st">"Exam123"</span><span class="op">)</span></span></code></pre></div>
<p>Currently, there is no option to delete exercises via the API. But
you can display the URL of an exercise via:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_resource_url.html">get_resource_url</a></span><span class="op">(</span>display_name <span class="op">=</span> <span class="st">"Exam123"</span><span class="op">)</span></span></code></pre></div>
<p>Or show all resources via:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_resources.html">get_resources</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will return a list with all resources, again nested in a
list.</p>
<p>If you want to have more fine-grained control for uploading, check
out the documentation <code><a href="../reference/upload2opal.html">?upload2opal</a></code></p>
</div>
<div class="section level2">
<h2 id="access-rights">Access rights<a class="anchor" aria-label="anchor" href="#access-rights"></a>
</h2>
<p>Note that the access rights of the resource are set to public by
default. This might appear very unusual, but for creating exercises
incrementally this is the best option. If you use any other access
rights, you need to login to OPAL via your browser to see the web page,
which will log you out via the API. Currently, there is not better
solution for this procedure. Take this into account if you upload
sensitive content! For instance, exercises that will be used in an
upcoming exam. You can set the access rights via</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">uplod2opal</span>(..., <span class="at">access =</span> ?)</span></code></pre></div>
<ul>
<li>1: only the persons responsible for this learning resource</li>
<li>2: responsible and other authors</li>
<li>3: all registered users</li>
<li>4: public, default value</li>
</ul>
</div>
<div class="section level2">
<h2 id="endpoint">Endpoint<a class="anchor" aria-label="anchor" href="#endpoint"></a>
</h2>
<p>We are using the OPAL instance <strong>E-Learning-Informationsportal
für Sächsische Hochschulen</strong>, so our package sets the endpoint
for <code>upload2opal</code> to <em><a href="https://bildungsportal.sachsen.de/opal/" class="external-link uri">https://bildungsportal.sachsen.de/opal/</a></em>. If you use
a different OPAL instance, you can either pass this to
<code>endpoint</code> of <code>upload2opal</code> or just set it as an
environment variable in the .Renviron file:
QTI_API_ENDPOINT=“yoururl”.</p>
</div>
<div class="section level2">
<h2 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h2>
<p><strong>403</strong> - Authorization failed. Some universities allow
the use of the API only within the university network. You may need to
run a VPN client to use the API. For TU Chemnitz <a href="https://www.tu-chemnitz.de/urz/network/access/vpn.html" class="external-link">see
here</a></p>
<p>If you already run a VPN client, please check with your IT and/or
OPAL provider, whether the API can be used and what configuration you
need.</p>
<p><strong>401</strong> Unauthorized</p>
<p>Your QTI_API_USER and/or QTI_API_PASSWORD are wrong or your
credentials are not sufficient to work with API.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Andrey Shevandrin, Johannes Titz, Stiftung für Innovation in der Hochschullehre.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
