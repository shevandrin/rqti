<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with the OPAL API • rqti</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with the OPAL API">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rqti</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Create Rmd exercises</h6></li>
    <li><a class="dropdown-item" href="../articles/singlechoice.html">Single Choice tasks</a></li>
    <li><a class="dropdown-item" href="../articles/multiplechoice.html">Multiple Choice tasks</a></li>
    <li><a class="dropdown-item" href="../articles/gap.html">Gap tasks</a></li>
    <li><a class="dropdown-item" href="../articles/dropdown.html">Dropdown tasks</a></li>
    <li><a class="dropdown-item" href="../articles/essay.html">Essay tasks</a></li>
    <li><a class="dropdown-item" href="../articles/order.html">Order tasks</a></li>
    <li><a class="dropdown-item" href="../articles/directedpairs.html">Directed Pair tasks</a></li>
    <li><a class="dropdown-item" href="../articles/table.html">Table tasks</a></li>
    <li><a class="dropdown-item" href="../articles/adding_metadata.html">Adding metadata</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Create sections and tests</h6></li>
    <li><a class="dropdown-item" href="../articles/section.html">Sections and Tests</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>API</h6></li>
    <li><a class="dropdown-item" href="../articles/api_opal.html">Working with the OPAL API</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>S4 rqti classes</h6></li>
    <li><a class="dropdown-item" href="../articles/rqti_oop_model.html">rqti OOP Model</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other</h6></li>
    <li><a class="dropdown-item" href="../articles/compatibility.html">Compatibility with Learning Management Systems</a></li>
    <li><a class="dropdown-item" href="../articles/imported_packages.html">Imported Packages</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/shevandrin/rqti/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Working with the OPAL API</h1>
            
            <h4 data-toc-skip class="date">2024-10-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/shevandrin/rqti/blob/main/vignettes/api_opal.Rmd" class="external-link"><code>vignettes/api_opal.Rmd</code></a></small>
      <div class="d-none name"><code>api_opal.Rmd</code></div>
    </div>

    
    
<p>The <code>rqti</code> package facilitates seamless content uploads to
the OPAL learning management system through its <code>upload2opal</code>
function, leveraging the OPAL API. In addition, there are useful
functions to get a list of resources and exchanging existing resources
in courses.</p>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>To leverage the functionality of the OPAL API, it is essential for
OPAL users to possess the requisite permissions. Access to the system
necessitates logging in with a username and password. Please note that
utilizing the API through Shibboleth authorization is not supported.</p>
<p>If you currently lack a password-based login, kindly submit a request
for one through your IT department. For users affiliated with <strong>TU
Chemnitz</strong>, you can expedite this process by sending an email to
<a href="mailto:e-learning@tu-chemnitz.de" class="email">e-learning@tu-chemnitz.de</a>. In your email, explicitly
state your need for a password-based login to facilitate API usage, and
include your username for reference. You should also state the purpose
of API usage. Please be aware that students typically do not possess
author rights by default and are required to request such privileges
before utilizing the API. To facilitate this process, it is advisable to
reach out to your IT and/or OPAL provider for assistance.</p>
<p>To store the username and password, <code>rqti</code> uses the
keyring system credential storage. The first time authentication is
attempted, it asks for a username and a password and saves them in a key
with service name “rqtiopal”. Once the key is created, it is
automatically used in further sessions. It is not recommended to create
additional keys unless you have a more complex setup (e.g. using
multiple learning management systems).</p>
<p>Some universities only allow to use the OPAL API in the network of
the university. Before calling <code>upload2opal()</code> set up a VPN
client accordingly. For TU Chemnitz see the instructions here: <a href="https://www.tu-chemnitz.de/urz/network/access/vpn.html" class="external-link uri">https://www.tu-chemnitz.de/urz/network/access/vpn.html</a></p>
</div>
<div class="section level2">
<h2 id="uploading-tasks-and-tests-to-opal">Uploading tasks and tests to OPAL<a class="anchor" aria-label="anchor" href="#uploading-tasks-and-tests-to-opal"></a>
</h2>
<p>You can either set the <code>knit: rqti::render_opal</code> parameter
in the yaml-section of your Rmd file or just call
<code>upload2opal()</code> with the file as the first parameter:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file</span> <span class="op">&lt;-</span> <span class="st">"my_zip_file.zip"</span> <span class="co"># or "task.Rmd" or "task.xml"</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">upload2opal</span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span></code></pre></div>
<p>Note that rqti-Rmd files as well as QTI compliant zip archives and
xml files are supported.</p>
<p>If you set up OPAL correctly you can expect the following outcome
after running the above command:</p>
<ol style="list-style-type: decimal">
<li>A web browser will open automatically, displaying the OPAL page with
your uploaded test or task.</li>
<li>In your R console, you will receive a status code 200. This status
code indicates that the request to upload the content to OPAL was
successful.</li>
<li>The result variable will contain a list with the following data:
<ul>
<li>$key: An identifier for this resource on OPAL, which you can use for
reference.</li>
<li>$display_name: The title of the resource as it appears in the
browser on OPAL.</li>
<li>$url: A permanent link to access this resource on OPAL.</li>
</ul>
</li>
</ol>
<p><code>upload2opal()</code> always checks the uniqueness of the
<code>display_name</code> in your personal repository of resources on
OPAL. If a resource with the same name is found, <code>rqti</code> will
overwrite it by default. This is useful for incrementally improving and
previewing/testing the task. It avoids cluttering your OPAL repo with
dozens of versions of the same task. If there are several resources with
the same name, <code>upload2opal</code> will ask you what to do.</p>
<p>By default <code>upload2opal()</code> uses the file name as the
<code>display_name</code>. But you can define your own as the second
parameter:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">upload2opal</span><span class="op">(</span><span class="va">file</span>, display_name <span class="op">=</span> <span class="st">"Exam123"</span><span class="op">)</span></span></code></pre></div>
<p>Currently, there is no option to delete tasks via the API. But you
can display the URL of a task via:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">get_resource_url</span><span class="op">(</span>display_name <span class="op">=</span> <span class="st">"Exam123"</span><span class="op">)</span></span></code></pre></div>
<p>Or return all resources as a dataframe via:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">get_resources</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If you want to have more fine-grained control for uploading, check
out the documentation <code>?upload2opal</code>.</p>
</div>
<div class="section level2">
<h2 id="access-rights">Access rights<a class="anchor" aria-label="anchor" href="#access-rights"></a>
</h2>
<p>Note that the access rights of the resource are set to public by
default. This might appear unusual, but for creating tasks incrementally
this is the best option. If you use any other access rights, you need to
login to OPAL via your browser to see the web page, which will log you
out via the API. Currently, there is not better solution for this
procedure. Take this into account if you upload sensitive content! For
instance, tasks that will be used in an upcoming exam. You can set the
access rights via</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">uplod2opal</span>(..., <span class="at">access =</span> ?)</span></code></pre></div>
<ul>
<li>1: only the persons responsible for this learning resource</li>
<li>2: responsible and other authors</li>
<li>3: all registered users</li>
<li>4: public, default value</li>
</ul>
</div>
<div class="section level2">
<h2 id="endpoint">Endpoint<a class="anchor" aria-label="anchor" href="#endpoint"></a>
</h2>
<p>We are using the OPAL instance <strong>E-Learning-Informationsportal
für Sächsische Hochschulen</strong>, so our package sets the endpoint
for <code>upload2opal</code> to <em><a href="https://bildungsportal.sachsen.de/opal/" class="external-link uri">https://bildungsportal.sachsen.de/opal/</a></em>. If you use
a different OPAL instance, you can either pass this to the
<code>endpoint</code> parameter of <code>upload2opal</code> or just set
it in .Rprofile: <code>Sys.setenv(RQTI_API_ENDPOINT = "yoururl")</code>.
When initiating an <code>rqti</code> project in RStudio through <em>New
Project</em>, you have the option to configure the API endpoint at that
stage. This configuration is also just written to the .Rprofile
file.</p>
</div>
<div class="section level2">
<h2 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h2>
<p>Various issues can occur with the API. While some problems can be
resolved quickly, you may often need to contact your IT department for
proper API setup. The most common issues include:</p>
<p><strong>403</strong> - Authorization failed. Some universities allow
the use of the API only within the university network. You may need to
run a VPN client to use the API. For TU Chemnitz see here: <a href="https://www.tu-chemnitz.de/urz/network/access/vpn.html" class="external-link uri">https://www.tu-chemnitz.de/urz/network/access/vpn.html</a></p>
<p>If you already run a VPN client, please check with your IT and/or
OPAL provider, whether the API can be used and what configuration you
need.</p>
<p><strong>401</strong> - Unauthorized. Your RQTI_API_USER or
RQTI_API_PASSWORD are wrong or your credentials are not sufficient to
work with the API. Please be aware that students typically do not
possess author rights by default and are required to request such
privileges before utilizing the API. To facilitate this process, it is
advisable to reach out to your IT and/or OPAL provider for
assistance.</p>
</div>
<div class="section level2">
<h2 id="opal-specific-yaml-attributes">OPAL specific yaml attributes<a class="anchor" aria-label="anchor" href="#opal-specific-yaml-attributes"></a>
</h2>
<p>There are several opal-specific yaml attributes, which are explicitly
explained in the articles on the task types. Two of them apply on the
test level:</p>
<div class="section level3">
<h3 id="calculator">calculator<a class="anchor" aria-label="anchor" href="#calculator"></a>
</h3>
<p>If a calculator is required for this task, you need to assign the
‘calculator’ attribute the type ‘simple’ or ‘scientific’.</p>
</div>
<div class="section level3">
<h3 id="files">files<a class="anchor" aria-label="anchor" href="#files"></a>
</h3>
<p>If additional files are required to complete this task, you need to
assign the ‘files’ attribute a single file path or a list of paths to
these files.</p>
<p>Note that setting these two attributes in the Rmd file directly is
mainly useful if you work on a single task. For collections of tasks
(tests) it is better to set these attributes when creating the test
intead of in the Rmd-file.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrey Shevandrin, Johannes Titz, Stiftung für Innovation in der Hochschullehre.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
